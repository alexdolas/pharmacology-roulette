<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Pharmacology Roulette</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Tailwind —á–µ—Ä–µ–∑ CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gradient-to-b from-purple-900 via-indigo-900 to-black min-h-screen flex items-center justify-center">
    <div id="root"></div>

    <!-- React + ReactDOM (UMD) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel, —á—Ç–æ–±—ã –±—Ä–∞—É–∑–µ—Ä –ø–æ–Ω–∏–º–∞–ª JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- –¢–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç -->
    <script type="text/babel">
      const { useState } = React;

      const PharmacologyRoulette = () => {
        const drugPairs = [
          { drug: 'Opioids', antidote: 'Naloxone', distractors: ['Flumazenil', 'Atropine', 'Glucagon'] },
          { drug: 'Acetaminophen', antidote: 'N-Acetylcysteine', distractors: ['Fomepizole', 'Methylene Blue', 'EDTA'] },
          { drug: 'Warfarin', antidote: 'Vitamin K', distractors: ['Protamine Sulfate', 'Vitamin B12', 'Calcium'] },
          { drug: 'Benzodiazepines', antidote: 'Flumazenil', distractors: ['Naloxone', 'Glucagon', 'Atropine'] },
          { drug: 'Carbon Monoxide', antidote: '100% Oxygen', distractors: ['Hydroxocobalamin', 'Methylene Blue', 'Naloxone'] },
          { drug: 'Beta Blockers', antidote: 'Glucagon', distractors: ['Calcium Chloride', 'Atropine', 'Epinephrine'] },
          { drug: 'Cyanide', antidote: 'Hydroxocobalamin', distractors: ['100% Oxygen', 'Methylene Blue', 'N-Acetylcysteine'] },
          { drug: 'Anticholinergics', antidote: 'Physostigmine', distractors: ['Atropine', 'Pralidoxime', 'Edrophonium'] },
          { drug: 'Digoxin', antidote: 'Digoxin Immune Fab', distractors: ['Calcium Chloride', 'Magnesium Sulfate', 'Potassium'] },
          { drug: 'Heparin', antidote: 'Protamine Sulfate', distractors: ['Vitamin K', 'Tranexamic Acid', 'FFP'] },
          { drug: 'Methanol', antidote: 'Fomepizole', distractors: ['N-Acetylcysteine', 'Ethanol', 'Naloxone'] },
          { drug: 'Ethylene Glycol', antidote: 'Fomepizole', distractors: ['Methylene Blue', 'Naloxone', 'Atropine'] },
          { drug: 'Iron', antidote: 'Deferoxamine', distractors: ['Penicillamine', 'EDTA', 'Dimercaprol'] },
          { drug: 'Lead', antidote: 'EDTA', distractors: ['Deferoxamine', 'Penicillamine', 'Naloxone'] },
          { drug: 'Cholinergics', antidote: 'Atropine', distractors: ['Physostigmine', 'Pralidoxime', 'Neostigmine'] },
          { drug: 'TCAs', antidote: 'Sodium Bicarbonate', distractors: ['Flumazenil', 'Naloxone', 'Atropine'] },
          { drug: 'Magnesium', antidote: 'Calcium Gluconate', distractors: ['Sodium Bicarb', 'Insulin', 'Kayexalate'] },
          { drug: 'Methemoglobin', antidote: 'Methylene Blue', distractors: ['N-Acetylcysteine', 'Fomepizole', 'Naloxone'] },
          { drug: 'Dabigatran', antidote: 'Idarucizumab', distractors: ['Andexanet Alfa', 'Vitamin K', 'Protamine'] },
          { drug: 'Rivaroxaban', antidote: 'Andexanet Alfa', distractors: ['Idarucizumab', 'Vitamin K', 'Protamine'] }
        ];

        const colors = [
          '#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8',
          '#F7DC6F', '#BB8FCE', '#85C1E2', '#F8B739', '#52B788',
          '#E74C3C', '#3498DB', '#F39C12', '#9B59B6', '#1ABC9C',
          '#E67E22', '#2ECC71', '#34495E', '#FF69B4', '#20B2AA'
        ];

        const [spinning, setSpinning] = useState(false);
        const [rotation, setRotation] = useState(0);
        const [currentDrug, setCurrentDrug] = useState(null);
        const [showModal, setShowModal] = useState(false);
        const [selectedAnswer, setSelectedAnswer] = useState(null);
        const [showResult, setShowResult] = useState(false);
        const [completedDrugs, setCompletedDrugs] = useState([]);
        const [shuffledOptions, setShuffledOptions] = useState([]);
        const [showConfetti, setShowConfetti] = useState(false);

        const shuffleArray = (array) => {
          const shuffled = [...array];
          for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
          }
          return shuffled;
        };

        const spinWheel = () => {
          if (spinning || completedDrugs.length === drugPairs.length) return;
          setSpinning(true);
          const availableDrugs = drugPairs.filter((_, index) => !completedDrugs.includes(index));
          const randomIndex = Math.floor(Math.random() * availableDrugs.length);
          const selectedDrug = availableDrugs[randomIndex];
          const drugIndex = drugPairs.indexOf(selectedDrug);
          const segmentAngle = 360 / drugPairs.length;
          const targetAngle = drugIndex * segmentAngle;
          const spins = 5;
          const finalRotation = rotation + (360 * spins) + (360 - targetAngle) + (segmentAngle / 2);
          setRotation(finalRotation);

          setTimeout(() => {
            setSpinning(false);
            setCurrentDrug({ ...selectedDrug, index: drugIndex });
            setShuffledOptions(shuffleArray([selectedDrug.antidote, ...selectedDrug.distractors]));
            setShowModal(true);
            setSelectedAnswer(null);
            setShowResult(false);
          }, 4000);
        };

        const handleAnswerSelect = (answer) => {
          if (showResult) return;
          setSelectedAnswer(answer);
          const isCorrect = answer === currentDrug.antidote;
          setShowResult(true);

          if (isCorrect && !completedDrugs.includes(currentDrug.index)) {
            setCompletedDrugs((prev) => [...prev, currentDrug.index]);
            setShowConfetti(true);
            setTimeout(() => setShowConfetti(false), 2000);
          }

          setTimeout(() => {
            setShowModal(false);
            setShowResult(false);
            setSelectedAnswer(null);
            setCurrentDrug(null);
          }, 2000);
        };

        const resetGame = () => {
          setCompletedDrugs([]);
          setRotation(0);
          setCurrentDrug(null);
          setShowModal(false);
          setSelectedAnswer(null);
          setShowResult(false);
          setShowConfetti(false);
        };

        const percentage = Math.round((completedDrugs.length / drugPairs.length) * 100);

        return (
          <div className="min-h-screen bg-gradient-to-b from-purple-900 via-indigo-900 to-black flex flex-col items-center justify-center p-4 relative overflow-hidden">
            {/* Confetti */}
            {showConfetti && (
              <div className="pointer-events-none fixed inset-0 flex justify-center items-start z-50 overflow-hidden">
                {[...Array(80)].map((_, i) => (
                  <div
                    key={i}
                    className="w-2 h-4 bg-gradient-to-b from-yellow-300 to-pink-500 rounded-sm animate-confetti"
                    style={{
                      position: 'absolute',
                      left: `${Math.random() * 100}%`,
                      animationDuration: `${2 + Math.random() * 1}s`,
                      animationDelay: `${Math.random() * 0.5}s`,
                    }}
                  />
                ))}
              </div>
            )}

            {/* Card */}
            <div className="relative max-w-md w-full bg-gradient-to-b from-indigo-950/80 via-slate-950/90 to-black/90 rounded-3xl border border-indigo-500/40 shadow-[0_0_80px_rgba(129,140,248,0.6)] p-5 md:p-6 backdrop-blur-xl z-10">
              {/* Header */}
              <div className="flex items-center justify-between mb-4">
                <div>
                  <h1 className="text-xl md:text-2xl font-extrabold text-white tracking-tight flex items-center gap-2">
                    <span className="w-6 h-6 flex items-center justify-center rounded-full bg-yellow-400 text-sm">üèÖ</span>
                    Toxicology Roulette
                  </h1>
                  <p className="text-xs md:text-sm text-indigo-100/80 mt-1">
                    Spin the wheel ¬∑ Match the antidote ¬∑ Own the tox exam
                  </p>
                </div>
                <button
                  onClick={resetGame}
                  className="flex items-center gap-1.5 px-2.5 py-1.5 rounded-full bg-slate-900/80 border border-indigo-500/60 text-[11px] md:text-xs text-indigo-100 hover:bg-slate-800 hover:border-amber-400/80 transition-all shadow-lg shadow-indigo-900/60"
                >
                  <span>‚ü≥</span>
                  Reset
                </button>
              </div>

              {/* Stats */}
              <div className="grid grid-cols-3 gap-2 mb-4">
                <div className="bg-slate-900/80 border border-indigo-500/40 rounded-2xl p-2.5 text-center shadow-md shadow-indigo-900/80">
                  <div className="text-[11px] text-indigo-200/90 font-medium">Pairs</div>
                  <div className="text-lg md:text-xl font-bold text-white">{drugPairs.length}</div>
                  <div className="text-[10px] text-indigo-300/80">total</div>
                </div>
                <div className="bg-slate-900/80 border border-emerald-500/40 rounded-2xl p-2.5 text-center shadow-md shadow-emerald-900/80">
                  <div className="text-[11px] text-emerald-200/90 font-medium">Completed</div>
                  <div className="text-lg md:text-xl font-bold text-emerald-300">
                    {completedDrugs.length}
                  </div>
                  <div className="text-[10px] text-emerald-200/70">antidotes</div>
                </div>
                <div className="bg-slate-900/80 border border-amber-400/50 rounded-2xl p-2.5 text-center shadow-md shadow-amber-900/80">
                  <div className="text-[11px] text-amber-200/90 font-medium">Score</div>
                  <div className="text-lg md:text-xl font-bold text-amber-300">{percentage}%</div>
                  <div className="text-[10px] text-amber-100/80">mastery</div>
                </div>
              </div>

              {/* Progress */}
              <div className="mb-4 text-center">
                <div className="text-gray-300 text-xs mb-2">
                  Progress: {completedDrugs.length} / {drugPairs.length}
                </div>
                <div className="w-56 h-2 bg-gray-800/80 rounded-full overflow-hidden mx-auto border border-slate-600/70">
                  <div
                    className="h-full bg-gradient-to-r from-emerald-400 via-yellow-300 to-rose-400 transition-all duration-500 shadow-[0_0_20px_rgba(251,191,36,0.7)]"
                    style={{ width: `${(completedDrugs.length / drugPairs.length) * 100}%` }}
                  />
                </div>
              </div>

              {/* Wheel */}
              <div className="relative mb-6 flex items-center justify-center">
                <div className="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-2 z-20">
                  <div className="w-0 h-0 border-l-[18px] border-l-transparent border-r-[18px] border-r-transparent border-t-[36px] border-t-red-600 drop-shadow-[0_0_20px_rgba(239,68,68,0.9)]" />
                </div>

                <div className="relative w-[320px] h-[320px] md:w-[380px] md:h-[380px]">
                  <svg
                    className="w-full h-full drop-shadow-2xl"
                    style={{
                      transform: `rotate(${rotation}deg)`,
                      transition: spinning
                        ? 'transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99)'
                        : 'none',
                    }}
                    viewBox="0 0 400 400"
                  >
                    <circle cx="200" cy="200" r="198" fill="#000" opacity="0.2" />
                    {drugPairs.map((pair, index) => {
                      const segmentAngle = 360 / drugPairs.length;
                      const angle = segmentAngle * index;
                      const nextAngle = segmentAngle * (index + 1);

                      const startRad = (angle - 90) * (Math.PI / 180);
                      const endRad = (nextAngle - 90) * (Math.PI / 180);
                      const midRad = (startRad + endRad) / 2;

                      const outerRadius = 195;
                      const x1 = 200 + outerRadius * Math.cos(startRad);
                      const y1 = 200 + outerRadius * Math.sin(startRad);
                      const x2 = 200 + outerRadius * Math.cos(endRad);
                      const y2 = 200 + outerRadius * Math.sin(endRad);

                      const isCompleted = completedDrugs.includes(index);

                      const textRadius = 130;
                      const textX = 200 + textRadius * Math.cos(midRad);
                      const textY = 200 + textRadius * Math.sin(midRad);

                      let rotationText = (midRad * 180) / Math.PI;
                      if (rotationText > 90 && rotationText < 270) {
                        rotationText += 180;
                      }

                      return (
                        <g key={index}>
                          <path
                            d={`M 200 200 L ${x1} ${y1} A ${outerRadius} ${outerRadius} 0 0 1 ${x2} ${y2} Z`}
                            fill={isCompleted ? '#374151' : colors[index]}
                            stroke="#fff"
                            strokeWidth="2"
                            opacity={isCompleted ? 0.3 : 1}
                          />
                          <text
                            x={textX}
                            y={textY}
                            fill="white"
                            fontSize="13"
                            fontWeight="bold"
                            textAnchor="middle"
                            dominantBaseline="middle"
                            opacity={isCompleted ? 0.4 : 1}
                            transform={`rotate(${rotationText} ${textX} ${textY})`}
                          >
                            {pair.drug}
                          </text>
                        </g>
                      );
                    })}
                    <defs>
                      <linearGradient id="centerGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stopColor="#ffd700" />
                        <stop offset="100%" stopColor="#ffed4e" />
                      </linearGradient>
                    </defs>
                    <circle cx="200" cy="200" r="35" fill="url(#centerGradient)" stroke="#ffd700" strokeWidth="3" />
                  </svg>
                </div>
              </div>

              {/* Button */}
              <button
                onClick={spinWheel}
                disabled={spinning || completedDrugs.length === drugPairs.length}
                className={`w-full px-8 py-3 rounded-full font-bold text-lg shadow-2xl transform transition-all duration-200 ${
                  spinning || completedDrugs.length === drugPairs.length
                    ? 'bg-slate-700/80 text-slate-300/70 cursor-not-allowed border border-slate-500/80'
                    : 'bg-gradient-to-r from-amber-400 via-yellow-300 to-rose-400 text-slate-900 border border-amber-300 shadow-[0_0_25px_rgba(251,191,36,0.9)] hover:scale-105 hover:shadow-[0_0_35px_rgba(251,191,36,1)] active:scale-95'
                }`}
              >
                {spinning
                  ? 'üéØ Spinning...'
                  : completedDrugs.length === drugPairs.length
                  ? '‚úÖ All pairs mastered!'
                  : 'üé∞ SPIN THE WHEEL'}
              </button>
            </div>

            <style jsx="true">{`
              @keyframes confetti {
                0% {
                  transform: translateY(0) rotate(0deg);
                  opacity: 1;
                }
                100% {
                  transform: translateY(100vh) rotate(720deg);
                  opacity: 0;
                }
              }
              .animate-confetti {
                animation: confetti linear forwards;
              }
            `}</style>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<PharmacologyRoulette />);
    </script>
  </body>
</html>
